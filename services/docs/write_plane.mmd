%%{init: {"theme": "default", "themeVariables": { "fontSize": "20px", "primaryColor": "#E0F2FE", "edgeLabelBackground":"#ffffff"}}}%%
flowchart TD

  A["ğŸ“¨ HTTP Client<br/>(POST /upload)"]:::client
  %% X["ğŸ” Auth Context"]:::auth
  Y["ğŸ›°ï¸ API Gateway"]:::apigw

  subgraph WRITE["âœï¸ Write Plane"]
    B["ğŸ“¡ Lambda API -<br/>Upload Handler"]:::lambda
    C["ğŸ“¦ Amazon S3"]:::s3
    D["ğŸ§© EventBridge<br/>(From S3 Upload)"]:::event
    E["ğŸ§© EventBridge<br/>(Triggers DB Handler)"]:::event
    F["ğŸ“¡ Lambda<br/>DynamoDB Handler"]:::lambda
    G["ğŸ—ƒï¸ DynamoDB Meals<br/>Table (with likes)"]:::ddb
    H["ğŸ” Lambda<br/>OpenSearch Indexer"]:::lambda
  end

  A -->|ğŸ” Auth Context| Y -->|Multipart Form| B
  B -->|Store Image| C
  C -->|Publish Event| D
  E -->|Meal Uploaded Event| F
  F -->|Insert Record| G
  G -->|DynamoDB Stream<br/>Event| H

  classDef client fill:#F0F9FF,stroke:#0284C7,color:#075985;
  classDef auth fill:#E0F2FE,stroke:#A3A3A3,color:#525252;
  classDef apigw fill:#E0F2FE,stroke:#06B6D4,color:#0F172A;
  classDef lambda fill:#E0F2FE,stroke:#0EA5E9,color:#1E3A8A;
  classDef s3 fill:#FEF9C3,stroke:#CA8A04,color:#78350F;
  classDef event fill:#DDD6FE,stroke:#8B5CF6,color:#4C1D95;
  classDef ddb fill:#BBF7D0,stroke:#22C55E,color:#14532D;
  classDef search fill:#F3E8FF,stroke:#A855F7,color:#6B21A8;

  linkStyle default stroke-width:2px,fill:none;
